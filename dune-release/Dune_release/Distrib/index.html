<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Distrib (dune-release.Dune_release.Distrib)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">dune-release</a> &#x00BB; <a href="../index.html">Dune_release</a> &#x00BB; Distrib</nav><h1>Module <code>Dune_release.Distrib</code></h1></header><section><header><h2 id="distribution-description"><a href="#distribution-description" class="anchor"></a>Distribution description</h2></header></section><section><header><h2 id="distrib"><a href="#distrib" class="anchor"></a>Distribution description</h2></header><dl><dt class="spec type" id="type-watermark"><a href="#type-watermark" class="anchor"></a><code><span class="keyword">type </span>watermark</code><code><span class="keyword"> = </span>string<span class="keyword"> * </span>[ `String of string<span class="keyword"> | </span>`Version<span class="keyword"> | </span>`Version_num<span class="keyword"> | </span>`Name<span class="keyword"> | </span>`Vcs of [ `Commit_id ]<span class="keyword"> | </span>`Opam of Fpath.t option<span class="keyword"> * </span>string<span class="keyword"> * </span>string ]</code><code></code></dt><dd><p>The type for watermarks. A watermark identifier, e.g. <code>&quot;ID&quot;</code> and its definition:</p><ul><li><code>`String s</code>, <code>s</code> is the definition.</li><li><code>`Name</code>, is the name of package.</li><li><code>`Version</code>, is the version of the distribution.</li><li><code>`Version_num</code>, is the version of the distribution with a potential leading <code>'v'</code> or <code>'V'</code> dropped.</li><li><code>`Vcs `Commit_id</code>, is the commit identifier (hash) of the distribution. May be post-fixed by <code>&quot;dirty&quot;</code> in dev package (<code>`Pin</code>) builds.</li><li><code>`Opam (file, field, sep)</code>, is the values of the field <code>field</code> concatenated with separator <code>sep</code> of the opam file <code>file</code>, expressed relative to the distribution root directory, if <code>file</code> is <code>None</code> this is the package's default opam file, see <code>describe</code>. Not all fields are supported see the value of <span class="xref-unresolved" title="unresolved reference to &quot;Opam.File.field_names&quot;"><span class="xref-unresolved" title="unresolved reference to &quot;Opam.File&quot;"><code>Opam</code>.File</span>.field_names</span>.</li></ul><p>When a file is watermarked with an identifier <code>&quot;ID&quot;</code>, any occurence of the sequence <code>%%ID%%</code> in its content is substituted by its definition.</p></dd></dl><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type </span>t</code><code></code><code></code></dt><dd><p>The type for describing distribution creation.</p></dd></dl><dl><dt class="spec value" id="val-v"><a href="#val-v" class="anchor"></a><code><span class="keyword">val </span>v : ?&#8288;watermarks:<a href="index.html#type-watermark">watermark</a> list <span>&#8209;&gt;</span> ?&#8288;files_to_watermark:(unit <span>&#8209;&gt;</span> (Fpath.t list, Rresult.R.msg) Rresult.result) <span>&#8209;&gt;</span> ?&#8288;massage:(unit <span>&#8209;&gt;</span> (unit, Rresult.R.msg) Rresult.result) <span>&#8209;&gt;</span> ?&#8288;exclude_paths:(unit <span>&#8209;&gt;</span> (Fpath.t list, Rresult.R.msg) Rresult.result) <span>&#8209;&gt;</span> unit <span>&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>distrib ~watermarks ~files_to_watermark ~massage
      ~exclude_paths ()</code> influences the distribution creation process performed by the <code>dune-release</code> tool. See the <span class="xref-unresolved" title="unresolved reference to &quot;distdetails&quot;"><span>full details about distribution creation</span></span>.</p><p>In the following the <em>distribution build directory</em> is a private clone of the package's source repository's <code>HEAD</code> when <code>dune-release distrib</code> is invoked.</p><ul><li><code>watermarks</code> defines the source watermarks for the distribution, defaults to <code>watermarks</code>.</li><li><code>files_to_watermark</code> is invoked in the distribution build directory to determine the files to watermark, defaults to <code>files_to_watermark</code>.</li><li><code>massage</code> is invoked in the distribution build directory, after watermarking, but before archiving. It can be used to generate distribution time build artefacts. Defaults to <code>massage</code>.</li><li><code>exclude_paths ()</code> is invoked in the distribution build directory, after massaging, to determine the paths that are excluded from being added to the distribution archive. Defaults to <code>exclude_paths</code>.</li></ul></dd></dl><dl><dt class="spec value" id="val-default_watermarks"><a href="#val-default_watermarks" class="anchor"></a><code><span class="keyword">val </span>default_watermarks : <a href="index.html#type-watermark">watermark</a> list</code></dt><dd><p><code>default_watermarks</code> is the default list of watermarks. It has the following elements:</p><ul><li><code>(&quot;NAME&quot;, `Name)</code></li><li><code>(&quot;VERSION&quot;, `Version)</code></li><li><code>(&quot;VERSION_NUM&quot;, `Version_num)</code></li><li><code>(&quot;VCS_COMMIT_ID&quot;, `Vcs [`Commit_id])</code></li><li><code>(&quot;PKG_MAINTAINER&quot;, `Opam (None, &quot;maintainer&quot;, &quot;, &quot;))</code></li><li><code>(&quot;PKG_AUTHORS&quot;, `Opam (None, &quot;authors&quot;, &quot;, &quot;)</code></li><li><code>(&quot;PKG_HOMEPAGE&quot;, `Opam (None, &quot;homepage&quot;, &quot; &quot;)</code></li><li><code>(&quot;PKG_ISSUES&quot;, `Opam (None, &quot;bug-reports&quot;, &quot; &quot;)</code></li><li><code>(&quot;PKG_DOC&quot;, `Opam (None, &quot;doc&quot;, &quot; &quot;))</code></li><li><code>(&quot;PKG_LICENSE&quot;, `Opam (None, &quot;license&quot;, &quot;, &quot;)</code></li><li><code>(&quot;PKG_REPO&quot;, `Opam (None, &quot;dev-repo&quot;, &quot; &quot;))</code></li></ul><p>Prepending to the list overrides default definitions.</p></dd></dl><dl><dt class="spec value" id="val-default_files_to_watermark"><a href="#val-default_files_to_watermark" class="anchor"></a><code><span class="keyword">val </span>default_files_to_watermark : unit <span>&#8209;&gt;</span> (Fpath.t list, Rresult.R.msg) Rresult.result</code></dt><dd><p><code>default_files_to_watermark ()</code> is the default list of files to watermark. It is invoked in the distribution build directory and gets the set of <a href="../Vcs/index.html#val-tracked_files"><span>tracked files</span></a> of this directory from which it removes the files that end with <code>.flv</code>, <code>.gif</code>, <code>.ico</code>, <code>.jpeg</code>, <code>.jpg</code>, <code>.mov</code>, <code>.mp3</code>, <code>.mp4</code>, <code>.otf</code>, <code>.pdf</code>, <code>.png</code>, <code>.ttf</code>, <code>.woff</code>.</p></dd></dl><dl><dt class="spec value" id="val-default_massage"><a href="#val-default_massage" class="anchor"></a><code><span class="keyword">val </span>default_massage : unit <span>&#8209;&gt;</span> (unit, Rresult.R.msg) Rresult.result</code></dt><dd><p><code>default_massage</code> is the default distribution massaging function. It is invoked in the distribution build directory and does nothing.</p></dd></dl><dl><dt class="spec value" id="val-default_exclude_paths"><a href="#val-default_exclude_paths" class="anchor"></a><code><span class="keyword">val </span>default_exclude_paths : unit <span>&#8209;&gt;</span> (Fpath.t list, Rresult.R.msg) Rresult.result</code></dt><dd><p><code>default_exclude_paths ()</code> is the default list of paths to exclude from the distribution archive. It is invoked in the distribution build directory and returns the following static set of files.</p><pre><code>fun () -&gt; Ok [&quot;.git&quot;; &quot;.gitignore&quot;; &quot;.gitattributes&quot;; &quot;.hg&quot;; &quot;.hgignore&quot;;
              &quot;build&quot;; &quot;Makefile&quot;; &quot;_build&quot;]</code></pre></dd></dl><dl><dt class="spec value" id="val-watermarks"><a href="#val-watermarks" class="anchor"></a><code><span class="keyword">val </span>watermarks : <a href="index.html#type-t">t</a> <span>&#8209;&gt;</span> <a href="index.html#type-watermark">watermark</a> list</code></dt><dt class="spec value" id="val-files_to_watermark"><a href="#val-files_to_watermark" class="anchor"></a><code><span class="keyword">val </span>files_to_watermark : <a href="index.html#type-t">t</a> <span>&#8209;&gt;</span> unit <span>&#8209;&gt;</span> (Fpath.t list, Rresult.R.msg) Rresult.result</code></dt><dt class="spec value" id="val-massage"><a href="#val-massage" class="anchor"></a><code><span class="keyword">val </span>massage : <a href="index.html#type-t">t</a> <span>&#8209;&gt;</span> unit <span>&#8209;&gt;</span> (unit, Rresult.R.msg) Rresult.result</code></dt><dt class="spec value" id="val-exclude_paths"><a href="#val-exclude_paths" class="anchor"></a><code><span class="keyword">val </span>exclude_paths : <a href="index.html#type-t">t</a> <span>&#8209;&gt;</span> unit <span>&#8209;&gt;</span> (Fpath.t list, Rresult.R.msg) Rresult.result</code></dt><dt class="spec value" id="val-define_watermarks"><a href="#val-define_watermarks" class="anchor"></a><code><span class="keyword">val </span>define_watermarks : dry_run:bool <span>&#8209;&gt;</span> name:string <span>&#8209;&gt;</span> version:string <span>&#8209;&gt;</span> opam:Fpath.t <span>&#8209;&gt;</span> <a href="index.html#type-watermark">watermark</a> list <span>&#8209;&gt;</span> (string<span class="keyword"> * </span>string) list</code></dt><dt class="spec value" id="val-watermark_files"><a href="#val-watermark_files" class="anchor"></a><code><span class="keyword">val </span>watermark_files : (string<span class="keyword"> * </span>string) list <span>&#8209;&gt;</span> Fpath.t list <span>&#8209;&gt;</span> (unit, Rresult.R.msg) Rresult.result</code></dt></dl></section></div></body></html>